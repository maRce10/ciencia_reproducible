<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>trampas_estadisticas.knit</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-2.0.6/clipboard.min.js"></script>
<link href="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
<script src="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
<script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="extra.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ciencia Reproducible</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Manuales
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="compendios_de_investigacion.html">Compendios de investigación</a>
    </li>
    <li>
      <a href="reproducibilidad_en_taxonómica.html">Reproducibilidad en la taxonomía</a>
    </li>
    <li>
      <a href="programacion_y_reproducibilidad.html">Programación y reproducibilidad</a>
    </li>
    <li>
      <a href="intro_a_git_y_github.html">Control de versiones: git y github</a>
    </li>
    <li>
      <a href="escribir_articulos_en_rmarkdown.html">Artículos en Rmarkdown</a>
    </li>
    <li>
      <a href="trampas_estadisticas.html">Trampas estadísticas</a>
    </li>
  </ul>
</li>
<li>
  <a href="preparacion_curso.html">Preparación para el curso</a>
</li>
<li>
  <a href="https://codefile.io/f/XOIzH23KfULuZKyZ1TYT">Compartir código</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tareas
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Tarea 1</li>
    <li class="dropdown-header">Solución: tarea 1</li>
    <li class="dropdown-header">Tarea 2</li>
    <li class="dropdown-header">Solución: tarea 2</li>
    <li class="dropdown-header">Tarea 3</li>
    <li class="dropdown-header">Solución: tarea 3</li>
    <li class="dropdown-header">Tarea 4</li>
    <li class="dropdown-header">Solución: tarea4</li>
  </ul>
</li>
<li>
  <a href="https://github.com/maRce10/ciencia_reproducible/raw/master/additional_files/2022-10-14_Probl Esp Ecol_15_Herramientas-Practicas-Para-Ciencia-Reproducible.pdf">Programa del curso</a>
</li>
<li>
  <a href="instructor.html">Instructor</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore"><center>
<font size="6"><b>Trampas estadísticas</b></font>
</center></h1>
<h3 class="subtitle"><center>
<font size="4"><b>Herramientas prácticas para investigación
reproducible</b></font>
</center></h3>
<h4 class="author"><center>
<font size="5"><a href="http://marceloarayasalas.weebly.com/">Marcelo
Araya-Salas, PhD</a></font>
</center></h4>
<h4 class="date"><center>
“2022-10-21”
</center></h4>

</div>


<style>
body
  { counter-reset: source-line 0; }
pre.numberSource code
  { counter-reset: none; }
</style>
<p> </p>
<div id="introducción" class="section level2">
<h2>Introducción</h2>
<p>En esta clase vamos a hablar de trampas estadísitcas que consciente o
inconscientemente podemos cometer en nuestro análisis, generando
resultados irreplicables. Nos vamos a enfocar en las consecuencias de
estas trampas y cómo evitamos caer en ellas.</p>
<img src="images/PoorStatistics.png" />
<p align="center">
<font size="2">Figura del artículo de <a
href="https://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970">Baker
(2016)</a>.
</p>
<div id="error-tipo-i" class="section level3">
<h3>Error tipo I</h3>
<p>Empecemos con un pequeño repaso del (principal) problema que queremos
evitar. <span style="color: #32CD32;">Queremos evitar concluir que hay
un mecanismo/patrón biológico, cuando en realidad no lo hay</span></p>
<p>Veamos un ejemplo de la vida real para distinguir error tipo I de
error tipo II</p>
<p align="center">
<p><img src="images/errores_estad.png" style="width:70.0%" /></p>
<div id="qué-tan-común-debe-ser-el-error-tipo-i" class="section level4">
<h4>¿Qué tan común debe ser el error tipo I?</h4>
<p>Depende de <span class="math inline">\(\alpha\)</span>. Si alpha =
0.05</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>error1 <span class="ot">&lt;-</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="cf">function</span>(<span class="co"># promedio de x</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="at">m1 =</span> <span class="dv">0</span>,</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="co"># desviacion de x</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="co"># n de x</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="at">n1 =</span> <span class="dv">1000</span>,</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="co"># promedio de y</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>    <span class="at">m2 =</span> m1,</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="co"># desviacion de y</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="at">sd2 =</span> sd1,</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="co"># n de y</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="at">n2 =</span> n1,</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="co"># n de simulaciones</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>    N,</span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="co"># alpha</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>    <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb1-18"><a href="#cb1-18"></a>    </span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="co"># Crear un vector para los valores de P</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>    V <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>    </span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb1-23"><a href="#cb1-23"></a>      <span class="co"># Simular dos variables independientes</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>      x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb1-25"><a href="#cb1-25"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n2, <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2)</span>
<span id="cb1-26"><a href="#cb1-26"></a>      </span>
<span id="cb1-27"><a href="#cb1-27"></a>      <span class="co"># x explica y?</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>      M <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb1-29"><a href="#cb1-29"></a>      S <span class="ot">&lt;-</span> <span class="fu">summary</span>(M)</span>
<span id="cb1-30"><a href="#cb1-30"></a>      </span>
<span id="cb1-31"><a href="#cb1-31"></a>      <span class="co"># extraer valor de P</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>      P <span class="ot">&lt;-</span> S<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb1-33"><a href="#cb1-33"></a>      </span>
<span id="cb1-34"><a href="#cb1-34"></a>      <span class="co"># agregarlo al vector</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>      V <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V, <span class="at">values =</span> P)</span>
<span id="cb1-36"><a href="#cb1-36"></a>    }</span>
<span id="cb1-37"><a href="#cb1-37"></a>    </span>
<span id="cb1-38"><a href="#cb1-38"></a>    <span class="co"># proporcion de resultados significativos</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>    Err <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(V <span class="sc">&lt;</span> a)) <span class="sc">/</span> N</span>
<span id="cb1-40"><a href="#cb1-40"></a>    </span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="co"># graficar el histograma, marcando el valor de a</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>    H <span class="ot">&lt;-</span> <span class="fu">hist</span>(V,</span>
<span id="cb1-43"><a href="#cb1-43"></a>              <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>              <span class="at">xlab =</span> <span class="st">&quot;Valor de P&quot;</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>              <span class="at">ylab =</span> <span class="st">&quot;Frequencia&quot;</span>)</span>
<span id="cb1-46"><a href="#cb1-46"></a>    <span class="fu">abline</span>(<span class="at">v =</span> a)</span>
<span id="cb1-47"><a href="#cb1-47"></a>    </span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="fu">cat</span>(<span class="st">&quot;Tasa de error tipo 1</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="fu">return</span>(Err)</span>
<span id="cb1-50"><a href="#cb1-50"></a>    <span class="fu">return</span>(H)</span>
<span id="cb1-51"><a href="#cb1-51"></a>  }</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="fu">error1</span>(<span class="at">a =</span> <span class="fl">0.05</span>, <span class="at">N =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p><img src="trampas_estadisticas_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre><code>## Tasa de error tipo 1</code></pre>
<pre><code>## [1] 0.04</code></pre>
<p> </p>
<style>
div.ejercicios { background-color:#F5F5DC; border-radius: 5px; padding: 5px}
div.discu { background-color:#6699CC; border-radius: 5px; padding: 5px}
</style>
</div>
</div>
<div id="ejercicio-1" class="section level3 ejercicios">
<h3>Ejercicio 1</h3>
<ol style="list-style-type: decimal">
<li>Corra la función error1() con dos diferentes valores de alpha</li>
<li>Corra la función error1() con dos diferentes valores de N</li>
</ol>
</div>
<p> </p>
<p>Ahora veamos algunas cosas que pueden hacer que este supuesto no se
cumpla…</p>
</div>
<div id="trampa-1-comparaciones-indirectas" class="section level2">
<h2>Trampa 1: Comparaciones indirectas</h2>
<p>Esta trampa consiste en hacer una interpretación acerca la diferencia
entre dos tratamientos o categorías, cuando en realidad lo que hicimos
fue investigar cada una por aparte.</p>
<p>Veámoslo en la práctica. La interpretación sería que el efecto de
<strong>X</strong> sobre <strong>Y</strong> es diferente entre las
categorías <strong>a</strong> y <strong>b</strong>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>trampa1 <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="cf">function</span>(<span class="co"># promedio de x</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="at">m1 =</span> <span class="dv">0</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="co"># desviacion de x</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="co"># n de x</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">n1 =</span> <span class="dv">1000</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="co"># promedio del error de y</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="at">m2 =</span> m1,</span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="co"># desviacion del error de y</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="at">sd2 =</span> sd1 <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="co"># efecto de x sobre y, por defecto un valor modesto</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>    <span class="at">m =</span> <span class="fl">0.05</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="co"># valor de y cuando x = 0</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="at">t =</span> <span class="dv">0</span>,</span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="co"># numero de simulaciones</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>    N,</span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="co">#alpha</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb4-20"><a href="#cb4-20"></a>    </span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="co"># Crear un vector para los valores de P</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="co"># interacccion treat:X</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    V.i <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="co"># efecto de x solo en treat = a</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>    V.a <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="co">#efecto de x solo en treat = b</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>    V.b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>    </span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb4-30"><a href="#cb4-30"></a>      <span class="co"># simular situacion en que y depende de x</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>      x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb4-32"><a href="#cb4-32"></a>      y <span class="ot">&lt;-</span> t <span class="sc">+</span> x <span class="sc">*</span> m  <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2)</span>
<span id="cb4-33"><a href="#cb4-33"></a>      </span>
<span id="cb4-34"><a href="#cb4-34"></a>      <span class="co"># asignar los valores a los dos tratamientos</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>      dat <span class="ot">&lt;-</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>        <span class="fu">data.frame</span>(<span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">each =</span> n1 <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb4-37"><a href="#cb4-37"></a>                   <span class="at">X =</span> <span class="fu">c</span>(x),</span>
<span id="cb4-38"><a href="#cb4-38"></a>                   <span class="at">Y =</span> <span class="fu">rep</span>(y))</span>
<span id="cb4-39"><a href="#cb4-39"></a>      </span>
<span id="cb4-40"><a href="#cb4-40"></a>      <span class="co"># el modelo correcto</span></span>
<span id="cb4-41"><a href="#cb4-41"></a>      M <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">*</span> treat, <span class="at">data =</span> dat)</span>
<span id="cb4-42"><a href="#cb4-42"></a>      S <span class="ot">&lt;-</span> <span class="fu">summary</span>(M)</span>
<span id="cb4-43"><a href="#cb4-43"></a>      </span>
<span id="cb4-44"><a href="#cb4-44"></a>      <span class="co"># los modelos que se hicieron</span></span>
<span id="cb4-45"><a href="#cb4-45"></a>      dat.a <span class="ot">&lt;-</span> dat[<span class="dv">1</span><span class="sc">:</span>(n1 <span class="sc">/</span> <span class="dv">2</span>), ]</span>
<span id="cb4-46"><a href="#cb4-46"></a>      M.a <span class="ot">&lt;-</span>  <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">dat =</span> dat.a)</span>
<span id="cb4-47"><a href="#cb4-47"></a>      S.a <span class="ot">&lt;-</span> <span class="fu">summary</span>(M.a)</span>
<span id="cb4-48"><a href="#cb4-48"></a>      </span>
<span id="cb4-49"><a href="#cb4-49"></a>      dat.b <span class="ot">&lt;-</span> dat[(n1 <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n1, ]</span>
<span id="cb4-50"><a href="#cb4-50"></a>      M.b <span class="ot">&lt;-</span>  <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> dat.b)</span>
<span id="cb4-51"><a href="#cb4-51"></a>      S.b <span class="ot">&lt;-</span> <span class="fu">summary</span>(M.b)</span>
<span id="cb4-52"><a href="#cb4-52"></a>      </span>
<span id="cb4-53"><a href="#cb4-53"></a>      <span class="co"># extraer valor de P de la interaccion</span></span>
<span id="cb4-54"><a href="#cb4-54"></a>      P.i <span class="ot">&lt;-</span> S<span class="sc">$</span>coefficients[<span class="dv">4</span>, <span class="dv">4</span>]</span>
<span id="cb4-55"><a href="#cb4-55"></a>      P.a <span class="ot">&lt;-</span> S.a<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb4-56"><a href="#cb4-56"></a>      P.b <span class="ot">&lt;-</span> S.b<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb4-57"><a href="#cb4-57"></a>      </span>
<span id="cb4-58"><a href="#cb4-58"></a>      <span class="co"># agregarlo al vector</span></span>
<span id="cb4-59"><a href="#cb4-59"></a>      V.i <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.i, <span class="at">values =</span> P.i)</span>
<span id="cb4-60"><a href="#cb4-60"></a>      V.a <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.a, <span class="at">values =</span> P.a)</span>
<span id="cb4-61"><a href="#cb4-61"></a>      V.b <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.b, <span class="at">values =</span> P.b)</span>
<span id="cb4-62"><a href="#cb4-62"></a>    }</span>
<span id="cb4-63"><a href="#cb4-63"></a>    </span>
<span id="cb4-64"><a href="#cb4-64"></a>    <span class="co"># Cuantos son significativos?</span></span>
<span id="cb4-65"><a href="#cb4-65"></a>    <span class="co"># error tipo 1 de la interaccion</span></span>
<span id="cb4-66"><a href="#cb4-66"></a>    Err.i <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(V.i <span class="sc">&lt;</span> a)) <span class="sc">/</span> N</span>
<span id="cb4-67"><a href="#cb4-67"></a>    </span>
<span id="cb4-68"><a href="#cb4-68"></a>    <span class="co"># proporcion de N en la hay significancia en un solo tratamiento</span></span>
<span id="cb4-69"><a href="#cb4-69"></a>    Err.t <span class="ot">&lt;-</span></span>
<span id="cb4-70"><a href="#cb4-70"></a>      <span class="fu">length</span>(<span class="fu">which</span>(V.a <span class="sc">&lt;</span> a <span class="sc">&amp;</span> V.b <span class="sc">&gt;=</span> a <span class="sc">|</span> V.a <span class="sc">&gt;=</span> a <span class="sc">&amp;</span> V.b <span class="sc">&lt;</span> a)) <span class="sc">/</span> N</span>
<span id="cb4-71"><a href="#cb4-71"></a>    </span>
<span id="cb4-72"><a href="#cb4-72"></a>    Err <span class="ot">&lt;-</span></span>
<span id="cb4-73"><a href="#cb4-73"></a>      <span class="fu">data.frame</span>(<span class="st">&quot;Tipo&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;interaccion&quot;</span>, <span class="st">&quot;trampa&quot;</span>),</span>
<span id="cb4-74"><a href="#cb4-74"></a>                 <span class="st">&quot;Tasa&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(Err.i, Err.t))</span>
<span id="cb4-75"><a href="#cb4-75"></a>    <span class="fu">cat</span>(<span class="st">&quot;Tasas de error </span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-76"><a href="#cb4-76"></a>    <span class="fu">return</span>(Err)</span>
<span id="cb4-77"><a href="#cb4-77"></a>  }</span>
<span id="cb4-78"><a href="#cb4-78"></a></span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="fu">trampa1</span>(<span class="at">N=</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Tasas de error</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Tipo
</th>
<th style="text-align:center;">
Tasa
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
interaccion
</td>
<td style="text-align:center;">
0.061
</td>
</tr>
<tr>
<td style="text-align:center;">
trampa
</td>
<td style="text-align:center;">
0.497
</td>
</tr>
</tbody>
</table>
<div id="ejercicio-2" class="section level3 ejercicios">
<h3>Ejercicio 2</h3>
<ol style="list-style-type: decimal">
<li>Investigue si este error depende del tamaño del efecto de X sobre Y
(m)</li>
<li>Investigue si este error depende del tamaño de muestra (n1)</li>
<li>Investigue si este error depende del error de medición en Y
(sd2)</li>
</ol>
</div>
<p> </p>
<div id="yo-soy-muy-inteligente" class="section level3">
<h3>Yo soy muy inteligente</h3>
<p>y no cometería un error así, porque es obvio que hay que incluir la
interacción en el modelo. Veamos un caso más complejo y más real.</p>
<p>Por ejemplo, en este diseño experimental, estamos viendo el efecto de
contaminación (Ct), y competencia (Cp) en una respuesta fisiológica al
estrés (R) y en tres especies de pecesitos (E).</p>
<p><img src="images/design.png" />  </p>
</div>
<div id="ejercicio-3" class="section level3 ejercicios">
<h3>Ejercicio 3</h3>
<ol style="list-style-type: decimal">
<li>En este caso, lo correcto es hacer R ~ Ct * Cp para cada especie, o
R ~ Ct * Cp * E?</li>
<li>Si su modelo es R ~ Ct * Cp * E, y la interacción Ct:Cp:E es
significativa, cómo la interpreta?</li>
</ol>
</div>
<p> </p>
</div>
<div id="trampa-2-inflación-de-n" class="section level2">
<h2>Trampa 2: Inflación de N</h2>
<p>Sigamos con el estudio del ejercicio anterior, pero por ahora vamos a
asumir que sólo hay una especie y una densidad:</p>
<p><img src="images/design2.png" /></p>
<p>Tenemos 30 tanques por tratamiento pcada uno con 9 peces, es decir
270 peces por tratamiento cada uno con una medida de estrés (E)
asociada.</p>
<p>¿Cuál es la <span style="color: #32CD32;"> <strong>unidad de
muestreo</strong></span> en este estudio?</p>
<p>¿Cuáles unidades podrían considerarse <span style="color: #32CD32;">
<strong>independientes</strong></span> entre sí?</p>
<p>Veamos que pasa si pensamos que los peces son unidades de muestreo
independientes. Vamos a simular una situación en la que la contaminación
aumenta el estrés pero el efecto es modualdo por condiciones específicas
en cada tanque.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">require</span>(lme4)</span>
<span id="cb6-3"><a href="#cb6-3"></a>trampa2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="co"># efecto promedio de Ct</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="at">m1 =</span> <span class="dv">1</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="co"># desviacion de Ct</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="co"># n de peces por tanque</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="at">n1 =</span> <span class="dv">9</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="co"># n de tanques</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="at">n2 =</span> <span class="dv">30</span>,</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="co"># efecto promedio de los tanques (Tnq)</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="at">m2 =</span> <span class="dv">0</span>,</span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="co"># desviacion de Tnq -&gt; indica cuánto se diferencian los tanques entre sí</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="at">sd2 =</span> <span class="dv">1</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="co"># promedio del error de E</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="at">m3 =</span> <span class="dv">0</span>,</span>
<span id="cb6-17"><a href="#cb6-17"></a>  <span class="co"># desviacion del error de E -&gt; indica la variación entre peces que no se debe al tanque</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="at">sd3 =</span> sd2 <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb6-19"><a href="#cb6-19"></a>  <span class="co"># valor de E cuando Ct = 0</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="at">t0 =</span> <span class="dv">0</span>,</span>
<span id="cb6-21"><a href="#cb6-21"></a>  <span class="co"># numero de simulaciones</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>  N,</span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="co">#alpha</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>  <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb6-25"><a href="#cb6-25"></a>  <span class="co"># crear vectores para guardar los resutados</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>  <span class="co"># efecto estimado en 3 modelos</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>  V.m1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>  V.m2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>  V.m3 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>  </span>
<span id="cb6-31"><a href="#cb6-31"></a>  <span class="co"># error estandar del efecto en 3 modelos</span></span>
<span id="cb6-32"><a href="#cb6-32"></a>  V.s1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>  V.s2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>  V.s3 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-35"><a href="#cb6-35"></a>  </span>
<span id="cb6-36"><a href="#cb6-36"></a>  <span class="co"># simulemos</span></span>
<span id="cb6-37"><a href="#cb6-37"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb6-38"><a href="#cb6-38"></a>    <span class="co"># un mismo efecto para todos los peces en un tanque</span></span>
<span id="cb6-39"><a href="#cb6-39"></a>    Tnq<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n2 , <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2), <span class="at">each =</span> n1)</span>
<span id="cb6-40"><a href="#cb6-40"></a>    <span class="co"># Sin Ct E depende solo del tanque y el pez</span></span>
<span id="cb6-41"><a href="#cb6-41"></a>    E<span class="fl">.0</span> <span class="ot">&lt;-</span> t0 <span class="sc">+</span> Tnq<span class="fl">.0</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1 <span class="sc">*</span> n2 ,</span>
<span id="cb6-42"><a href="#cb6-42"></a>                              <span class="at">mean =</span> m3,</span>
<span id="cb6-43"><a href="#cb6-43"></a>                              <span class="at">sd =</span> sd3)</span>
<span id="cb6-44"><a href="#cb6-44"></a>    </span>
<span id="cb6-45"><a href="#cb6-45"></a>    <span class="co"># efecto de las contaminacion</span></span>
<span id="cb6-46"><a href="#cb6-46"></a>    Ct <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n2 <span class="sc">*</span> n1,</span>
<span id="cb6-47"><a href="#cb6-47"></a>                <span class="at">mean =</span> m1,</span>
<span id="cb6-48"><a href="#cb6-48"></a>                <span class="at">sd =</span> sd1)</span>
<span id="cb6-49"><a href="#cb6-49"></a>    <span class="co"># un mismo efecto adicional para todos los peces en un tanque</span></span>
<span id="cb6-50"><a href="#cb6-50"></a>    Tnq<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n2 , <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2), <span class="at">each =</span> n1)</span>
<span id="cb6-51"><a href="#cb6-51"></a>    <span class="co"># estres depende del pez, el tanque y la contaminacion</span></span>
<span id="cb6-52"><a href="#cb6-52"></a>    E<span class="fl">.1</span> <span class="ot">&lt;-</span> t0 <span class="sc">+</span>  Ct <span class="sc">+</span> Tnq<span class="fl">.1</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1 <span class="sc">*</span> n2 ,</span>
<span id="cb6-53"><a href="#cb6-53"></a>                                    <span class="at">mean =</span> m3,</span>
<span id="cb6-54"><a href="#cb6-54"></a>                                    <span class="at">sd =</span> sd3)</span>
<span id="cb6-55"><a href="#cb6-55"></a>    <span class="co"># juntamos todo</span></span>
<span id="cb6-56"><a href="#cb6-56"></a>    dat1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-57"><a href="#cb6-57"></a>      <span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;0&quot;</span> , <span class="st">&quot;1&quot;</span>), <span class="at">each =</span> n1 <span class="sc">*</span> n2),</span>
<span id="cb6-58"><a href="#cb6-58"></a>      <span class="at">E =</span> <span class="fu">c</span>(E<span class="fl">.0</span>, E<span class="fl">.1</span>),</span>
<span id="cb6-59"><a href="#cb6-59"></a>      <span class="at">Tnq =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>(n2 <span class="sc">*</span> <span class="dv">2</span>)), <span class="at">each =</span> n1)</span>
<span id="cb6-60"><a href="#cb6-60"></a>    )</span>
<span id="cb6-61"><a href="#cb6-61"></a>    <span class="co"># modelo con peces como unidades de muestreo</span></span>
<span id="cb6-62"><a href="#cb6-62"></a>    M<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(E <span class="sc">~</span> treat, <span class="at">data =</span> dat1)</span>
<span id="cb6-63"><a href="#cb6-63"></a>    S<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">summary</span>(M<span class="fl">.1</span>)</span>
<span id="cb6-64"><a href="#cb6-64"></a>    </span>
<span id="cb6-65"><a href="#cb6-65"></a>    <span class="co"># y si sacamos el promedio del nivel de estres por tanque</span></span>
<span id="cb6-66"><a href="#cb6-66"></a>    dat2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(dat1<span class="sc">$</span>E,</span>
<span id="cb6-67"><a href="#cb6-67"></a>                      <span class="at">by =</span> <span class="fu">list</span> (dat1<span class="sc">$</span>treat, dat1<span class="sc">$</span>Tnq),</span>
<span id="cb6-68"><a href="#cb6-68"></a>                      <span class="at">FUN =</span> mean)</span>
<span id="cb6-69"><a href="#cb6-69"></a>    <span class="fu">colnames</span>(dat2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;treat&quot;</span>, <span class="st">&quot;Tnq&quot;</span>, <span class="st">&quot;E&quot;</span>)</span>
<span id="cb6-70"><a href="#cb6-70"></a>    </span>
<span id="cb6-71"><a href="#cb6-71"></a>    <span class="co"># modelo con tanques como unidades de muestreo</span></span>
<span id="cb6-72"><a href="#cb6-72"></a>    M<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(E <span class="sc">~</span> treat, <span class="at">data =</span> dat2)</span>
<span id="cb6-73"><a href="#cb6-73"></a>    S<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">summary</span>(M<span class="fl">.2</span>)</span>
<span id="cb6-74"><a href="#cb6-74"></a>    </span>
<span id="cb6-75"><a href="#cb6-75"></a>    <span class="co"># modelo mixto</span></span>
<span id="cb6-76"><a href="#cb6-76"></a>    M<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(E <span class="sc">~</span> treat <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Tnq), <span class="at">data =</span> dat1)</span>
<span id="cb6-77"><a href="#cb6-77"></a>    S<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">summary</span>(M<span class="fl">.3</span>)</span>
<span id="cb6-78"><a href="#cb6-78"></a>    </span>
<span id="cb6-79"><a href="#cb6-79"></a>    <span class="co"># guardamos efectos y errores estandar en los vectores</span></span>
<span id="cb6-80"><a href="#cb6-80"></a>    V.m1 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.m1, S<span class="fl">.1</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb6-81"><a href="#cb6-81"></a>    V.s1 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.s1, S<span class="fl">.1</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb6-82"><a href="#cb6-82"></a>    </span>
<span id="cb6-83"><a href="#cb6-83"></a>    V.m2 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.m2, S<span class="fl">.2</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb6-84"><a href="#cb6-84"></a>    V.s2 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.s2, S<span class="fl">.2</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb6-85"><a href="#cb6-85"></a>    </span>
<span id="cb6-86"><a href="#cb6-86"></a>    V.m3 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.m3, S<span class="fl">.3</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb6-87"><a href="#cb6-87"></a>    V.s3 <span class="ot">&lt;-</span> <span class="fu">append</span>(V.s3, S<span class="fl">.3</span><span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb6-88"><a href="#cb6-88"></a>  }</span>
<span id="cb6-89"><a href="#cb6-89"></a>  </span>
<span id="cb6-90"><a href="#cb6-90"></a>  <span class="co"># juntamos todo todo</span></span>
<span id="cb6-91"><a href="#cb6-91"></a>  err.df <span class="ot">&lt;-</span></span>
<span id="cb6-92"><a href="#cb6-92"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb6-93"><a href="#cb6-93"></a>      <span class="at">modelo =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(</span>
<span id="cb6-94"><a href="#cb6-94"></a>        <span class="fu">c</span>(<span class="st">&quot;n.total&quot;</span>, <span class="st">&quot;n.tanques&quot;</span>, <span class="st">&quot;mixto&quot;</span>), <span class="at">each =</span> N</span>
<span id="cb6-95"><a href="#cb6-95"></a>      ), <span class="dv">2</span>),</span>
<span id="cb6-96"><a href="#cb6-96"></a>      <span class="at">valor =</span> <span class="fu">c</span>(V.m1, V.m2, V.m3, V.s1, V.s2, V.s3),</span>
<span id="cb6-97"><a href="#cb6-97"></a>      <span class="at">par =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;promedio&quot;</span>, <span class="st">&quot;se&quot;</span>), <span class="at">each =</span> N <span class="sc">*</span> <span class="dv">3</span>)</span>
<span id="cb6-98"><a href="#cb6-98"></a>    )</span>
<span id="cb6-99"><a href="#cb6-99"></a>  </span>
<span id="cb6-100"><a href="#cb6-100"></a>  <span class="co"># graficamos los histogramas de cada modelo para el efecto y el error</span></span>
<span id="cb6-101"><a href="#cb6-101"></a>  p <span class="ot">&lt;-</span></span>
<span id="cb6-102"><a href="#cb6-102"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> err.df, <span class="fu">aes</span>(<span class="at">x =</span> valor, <span class="at">colour =</span> modelo, <span class="at">fill =</span> modelo)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(</span>
<span id="cb6-103"><a href="#cb6-103"></a>      <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb6-104"><a href="#cb6-104"></a>      <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>,</span>
<span id="cb6-105"><a href="#cb6-105"></a>      <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb6-106"><a href="#cb6-106"></a>      <span class="at">lwd =</span> <span class="fl">0.2</span></span>
<span id="cb6-107"><a href="#cb6-107"></a>    ) <span class="sc">+</span></span>
<span id="cb6-108"><a href="#cb6-108"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> par, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-109"><a href="#cb6-109"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>, <span class="st">&quot;#00416A&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-110"><a href="#cb6-110"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>, <span class="st">&quot;#00416A&quot;</span>))</span>
<span id="cb6-111"><a href="#cb6-111"></a>  <span class="fu">return</span>(p)</span>
<span id="cb6-112"><a href="#cb6-112"></a>}</span>
<span id="cb6-113"><a href="#cb6-113"></a></span>
<span id="cb6-114"><a href="#cb6-114"></a><span class="fu">trampa2</span>(<span class="at">m1 =</span> <span class="dv">1</span>, <span class="at">sd2 =</span> <span class="dv">2</span>, <span class="at">sd3 =</span> <span class="dv">1</span>, <span class="at">N =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p><img src="trampas_estadisticas_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div id="ejercicio-4" class="section level3 ejercicios">
<h3>Ejercicio 4</h3>
<ol style="list-style-type: decimal">
<li>¿Cuál es la consecuencia de aumentar sd2? ¿Por qué?</li>
<li>¿Cuáles son los grados de libertad en el modelo 1 y en el modelos
2?</li>
</ol>
</div>
<p> </p>
</div>
<div id="trampa-3-tamaño-de-muestra-pequeño" class="section level2">
<h2>Trampa 3: Tamaño de muestra pequeño</h2>
<p>En biología nos formamos pensando que un tamaño de muestra prqueño no
es deseable. Pero ¿por qué? Tal vez tenemos la intuición de que el poder
estadístico (la capacidad de detectar un efecto cuando el efecto existe)
está relacionadon con nuestro tamaño de muestra. Hasta ahí vamos
bien.</p>
<p>Tal vez también sabemos que un mayor tamaño de muestra nos ayuda a
obtener estimados más precisos. Y si comobinamos estas dos afirmaciones
podemos concluir que <span style="color: #32CD32;">si un efecto es
pequeño (i.e. cercano a 0) vamos a necesitar un mayor tamaño de muestra
para poder deterctarlo.</span></p>
<p>Creo que hasta aquí seguimos bien. El problema es que a veces
derivamos una conclusión más, que sería algo así:</p>
<p><em>Esto quiere decir que si yo ya detecté un efecto con un tamaño de
muestra pequeño, el efecto real debe ser grande, ya que si hubiera sido
pequeño no lo hubiera podido detectar</em></p>
<p>Este razonamiento nos llevaría a no desconfiar de un resultado
significativo obtenido con un tamaño de muestra pequeño y tal vez nos
llevaría incluso a creer todavía más en la importancia de este
efecto.</p>
<p>¡Veamos el problema!</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>trampa3 <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="cf">function</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="co"># promedio de x</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="at">m1 =</span> <span class="dv">0</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="co"># desviacion de x</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="co"># promedio de y</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="at">m2 =</span> m1,</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="co"># desviacion de y</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="at">sd2 =</span> sd1,</span>
<span id="cb7-11"><a href="#cb7-11"></a>     <span class="co"># n de muestra pequenia</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">np =</span> <span class="dv">10</span>,</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="co"># n de de muestra grande </span></span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="at">ng =</span> <span class="dv">30</span>,</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="co"># n de simulaciones</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>    N,</span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="co"># alpha</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>    <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb7-19"><a href="#cb7-19"></a>    <span class="co"># Crear vectores para los valores de P, R y beta</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>    V.P  <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>    V.R <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>    V.b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>    </span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="co"># n pequenio</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb7-26"><a href="#cb7-26"></a>      </span>
<span id="cb7-27"><a href="#cb7-27"></a>      <span class="co"># Simulamos dos variables independientes</span></span>
<span id="cb7-28"><a href="#cb7-28"></a>      x.p <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> np, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb7-29"><a href="#cb7-29"></a>      y.p <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> np, <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2)</span>
<span id="cb7-30"><a href="#cb7-30"></a>      </span>
<span id="cb7-31"><a href="#cb7-31"></a>      <span class="co"># x explica y?</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>      M.p <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.p <span class="sc">~</span> x.p)</span>
<span id="cb7-33"><a href="#cb7-33"></a>      S.p <span class="ot">&lt;-</span> <span class="fu">summary</span>(M.p)</span>
<span id="cb7-34"><a href="#cb7-34"></a>      </span>
<span id="cb7-35"><a href="#cb7-35"></a>      <span class="co"># extraemos valor de P</span></span>
<span id="cb7-36"><a href="#cb7-36"></a>      P.p <span class="ot">&lt;-</span> S.p<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb7-37"><a href="#cb7-37"></a>      </span>
<span id="cb7-38"><a href="#cb7-38"></a>      <span class="co"># extraemos R</span></span>
<span id="cb7-39"><a href="#cb7-39"></a>      R.p <span class="ot">&lt;-</span> S.p<span class="sc">$</span>adj.r.squared</span>
<span id="cb7-40"><a href="#cb7-40"></a>      </span>
<span id="cb7-41"><a href="#cb7-41"></a>      <span class="co"># extraemos pendiente</span></span>
<span id="cb7-42"><a href="#cb7-42"></a>      beta.p <span class="ot">&lt;-</span> S.p<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb7-43"><a href="#cb7-43"></a>      </span>
<span id="cb7-44"><a href="#cb7-44"></a>      <span class="co"># agregamos los valores a los vectores correspondientes</span></span>
<span id="cb7-45"><a href="#cb7-45"></a>      V.P <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.P, <span class="at">values =</span> P.p)</span>
<span id="cb7-46"><a href="#cb7-46"></a>      V.R <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.R, <span class="at">values =</span> R.p)</span>
<span id="cb7-47"><a href="#cb7-47"></a>      V.b <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.b, <span class="at">values =</span> beta.p)</span>
<span id="cb7-48"><a href="#cb7-48"></a>    }</span>
<span id="cb7-49"><a href="#cb7-49"></a>    </span>
<span id="cb7-50"><a href="#cb7-50"></a>    <span class="co"># n grande</span></span>
<span id="cb7-51"><a href="#cb7-51"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb7-52"><a href="#cb7-52"></a>      </span>
<span id="cb7-53"><a href="#cb7-53"></a>      <span class="co"># Simulamos dos variables independientes</span></span>
<span id="cb7-54"><a href="#cb7-54"></a>      x.g <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> ng, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb7-55"><a href="#cb7-55"></a>      y.g <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> ng, <span class="at">mean =</span> m2, <span class="at">sd =</span> sd2)</span>
<span id="cb7-56"><a href="#cb7-56"></a>      </span>
<span id="cb7-57"><a href="#cb7-57"></a>      <span class="co"># x explica y?</span></span>
<span id="cb7-58"><a href="#cb7-58"></a>      M.g <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.g <span class="sc">~</span> x.g)</span>
<span id="cb7-59"><a href="#cb7-59"></a>      S.g <span class="ot">&lt;-</span> <span class="fu">summary</span>(M.g)</span>
<span id="cb7-60"><a href="#cb7-60"></a>      </span>
<span id="cb7-61"><a href="#cb7-61"></a>      <span class="co"># extraemos valor de P</span></span>
<span id="cb7-62"><a href="#cb7-62"></a>      P.g <span class="ot">&lt;-</span> S.g<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb7-63"><a href="#cb7-63"></a>      </span>
<span id="cb7-64"><a href="#cb7-64"></a>      <span class="co"># extraemos R</span></span>
<span id="cb7-65"><a href="#cb7-65"></a>      R.g <span class="ot">&lt;-</span> S.g<span class="sc">$</span>adj.r.squared</span>
<span id="cb7-66"><a href="#cb7-66"></a>      </span>
<span id="cb7-67"><a href="#cb7-67"></a>      <span class="co"># extraemos pendiente</span></span>
<span id="cb7-68"><a href="#cb7-68"></a>      beta.g <span class="ot">&lt;-</span> S.g<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb7-69"><a href="#cb7-69"></a>      </span>
<span id="cb7-70"><a href="#cb7-70"></a>      <span class="co"># aagregamos los valores a los vectores correspondientes</span></span>
<span id="cb7-71"><a href="#cb7-71"></a>      V.P <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.P, <span class="at">values =</span> P.g)</span>
<span id="cb7-72"><a href="#cb7-72"></a>      V.R <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.R, <span class="at">values =</span> R.g)</span>
<span id="cb7-73"><a href="#cb7-73"></a>      V.b <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.b, <span class="at">values =</span> beta.g)</span>
<span id="cb7-74"><a href="#cb7-74"></a>    }</span>
<span id="cb7-75"><a href="#cb7-75"></a>    </span>
<span id="cb7-76"><a href="#cb7-76"></a>    <span class="co"># juntamos todo</span></span>
<span id="cb7-77"><a href="#cb7-77"></a>    dat <span class="ot">&lt;-</span></span>
<span id="cb7-78"><a href="#cb7-78"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb7-79"><a href="#cb7-79"></a>        <span class="at">n =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;pq&quot;</span>, <span class="st">&quot;gd&quot;</span>), <span class="at">each =</span> N),</span>
<span id="cb7-80"><a href="#cb7-80"></a>        <span class="at">P =</span> V.P,</span>
<span id="cb7-81"><a href="#cb7-81"></a>        <span class="at">R =</span> V.R,</span>
<span id="cb7-82"><a href="#cb7-82"></a>        <span class="at">beta =</span> V.b</span>
<span id="cb7-83"><a href="#cb7-83"></a>      )</span>
<span id="cb7-84"><a href="#cb7-84"></a>    </span>
<span id="cb7-85"><a href="#cb7-85"></a>    <span class="co"># proporcion de resultados significativos</span></span>
<span id="cb7-86"><a href="#cb7-86"></a>    Err.p <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;pq&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)) <span class="sc">/</span> N</span>
<span id="cb7-87"><a href="#cb7-87"></a>    Err.g <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;gd&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)) <span class="sc">/</span> N</span>
<span id="cb7-88"><a href="#cb7-88"></a>    </span>
<span id="cb7-89"><a href="#cb7-89"></a>    <span class="co"># R promedio de falsos positivos</span></span>
<span id="cb7-90"><a href="#cb7-90"></a>    R.p <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>R[<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;pq&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)])</span>
<span id="cb7-91"><a href="#cb7-91"></a>    R.g <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>R[<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;gd&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)])</span>
<span id="cb7-92"><a href="#cb7-92"></a>    </span>
<span id="cb7-93"><a href="#cb7-93"></a>    <span class="co"># beta promedio de falsos positivos</span></span>
<span id="cb7-94"><a href="#cb7-94"></a>    b.p <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>beta[<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;pq&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)])</span>
<span id="cb7-95"><a href="#cb7-95"></a>    b.g <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>beta[<span class="fu">which</span>(dat<span class="sc">$</span>n <span class="sc">==</span> <span class="st">&quot;gd&quot;</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>P <span class="sc">&lt;</span> a)])</span>
<span id="cb7-96"><a href="#cb7-96"></a>    </span>
<span id="cb7-97"><a href="#cb7-97"></a>    <span class="co"># cuadro para imprimir</span></span>
<span id="cb7-98"><a href="#cb7-98"></a>    err.df <span class="ot">&lt;-</span></span>
<span id="cb7-99"><a href="#cb7-99"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb7-100"><a href="#cb7-100"></a>        <span class="at">par =</span> <span class="fu">c</span>(<span class="st">&quot;error.1&quot;</span>, <span class="st">&quot;R.promedio&quot;</span>, <span class="st">&quot;beta.promedio&quot;</span>),</span>
<span id="cb7-101"><a href="#cb7-101"></a>        <span class="at">pq =</span> <span class="fu">c</span>(Err.p, R.p, b.p),</span>
<span id="cb7-102"><a href="#cb7-102"></a>        <span class="at">gd =</span> <span class="fu">c</span>(Err.g, R.g, b.g)</span>
<span id="cb7-103"><a href="#cb7-103"></a>      )</span>
<span id="cb7-104"><a href="#cb7-104"></a>    </span>
<span id="cb7-105"><a href="#cb7-105"></a>    <span class="co"># agreguemos una columna indicando si la prueba es significativa</span></span>
<span id="cb7-106"><a href="#cb7-106"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span> <span class="sc">*</span> N)) {</span>
<span id="cb7-107"><a href="#cb7-107"></a>      <span class="fu">ifelse</span>(dat<span class="sc">$</span>P[i] <span class="sc">&gt;=</span> a, dat<span class="sc">$</span>S[i] <span class="ot">&lt;-</span></span>
<span id="cb7-108"><a href="#cb7-108"></a>               <span class="st">&quot;N.S.&quot;</span>, dat<span class="sc">$</span>S[i] <span class="ot">&lt;-</span> <span class="st">&quot;Significativo&quot;</span>)</span>
<span id="cb7-109"><a href="#cb7-109"></a>    }</span>
<span id="cb7-110"><a href="#cb7-110"></a>    </span>
<span id="cb7-111"><a href="#cb7-111"></a>    <span class="co"># graficamos los histogramas de R para cada tamanio de muestra y en pruebas N.S. o significativas</span></span>
<span id="cb7-112"><a href="#cb7-112"></a>    p <span class="ot">&lt;-</span></span>
<span id="cb7-113"><a href="#cb7-113"></a>      <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> R, <span class="at">colour =</span> n, <span class="at">fill =</span> n)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(</span>
<span id="cb7-114"><a href="#cb7-114"></a>        <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb7-115"><a href="#cb7-115"></a>        <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb7-116"><a href="#cb7-116"></a>        <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb7-117"><a href="#cb7-117"></a>        <span class="at">lwd =</span> <span class="fl">0.2</span></span>
<span id="cb7-118"><a href="#cb7-118"></a>      ) <span class="sc">+</span></span>
<span id="cb7-119"><a href="#cb7-119"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>( <span class="sc">~</span> S, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-120"><a href="#cb7-120"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-121"><a href="#cb7-121"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>))</span>
<span id="cb7-122"><a href="#cb7-122"></a>    p</span>
<span id="cb7-123"><a href="#cb7-123"></a>    </span>
<span id="cb7-124"><a href="#cb7-124"></a>    <span class="co"># resultado</span></span>
<span id="cb7-125"><a href="#cb7-125"></a>    <span class="fu">cat</span>(<span class="st">&quot;Comparacion entre tamanios de muestra</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb7-126"><a href="#cb7-126"></a>    out <span class="ot">&lt;-</span> <span class="fu">list</span>(err.df, p)</span>
<span id="cb7-127"><a href="#cb7-127"></a>    <span class="fu">return</span>(out)</span>
<span id="cb7-128"><a href="#cb7-128"></a>    </span>
<span id="cb7-129"><a href="#cb7-129"></a>  }</span>
<span id="cb7-130"><a href="#cb7-130"></a></span>
<span id="cb7-131"><a href="#cb7-131"></a><span class="fu">trampa3</span>(<span class="at">N =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Comparacion entre tamanios de muestra</code></pre>
<pre><code>## [[1]]
##             par        pq        gd
## 1       error.1 0.0550000 0.0500000
## 2    R.promedio 0.4425002 0.1565095
## 3 beta.promedio 0.2652847 0.1774619
## 
## [[2]]</code></pre>
<p><img src="trampas_estadisticas_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div id="moraleja" class="section level4">
<h4>Moraleja</h4>
<p>Los falsos postivos con tamaños de muestra pequeños típicamente son
efectos grandes.</p>
</div>
<div id="ejercicio-5" class="section level3 ejercicios">
<h3>Ejercicio 5</h3>
<ol style="list-style-type: decimal">
<li>¿Qué pasa si aumenta el tamaño de muestra grande a 100? ¿Por
qué?</li>
<li>¿Qué esperaría con respecto a la distribución de valores de R si el
tamaño de muestra fuera infinito?</li>
</ol>
</div>
<p> </p>
<div id="discusión" class="section level3 discu">
<h3>Discusión</h3>
<p>¿Y entonces cuál es un tamaño de muestra apropiado?</p>
</div>
<p> </p>
</div>
<div id="trampa-4-comparaciones-múltiples" class="section level2">
<h2>Trampa 4: Comparaciones múltiples</h2>
<p align="center">
<img src="images/multipletesting.png" style="width:50.0%" />
</p>
<p>Comic: Randall Munroe, <a href="https://xkcd.com/">xkcd.com</a> / CC
BY-NC (<a href="https://creativecommons.org/licenses/by-nc/2.5/"
class="uri">https://creativecommons.org/licenses/by-nc/2.5/</a>)</p>
<p>Al inicio de la clase vimos que alpha representa la probabilidad de
un efecto espúreo, es decir, un efecto que detectamos estadísticamente
aún cuando las variables son independientes. La idea aquí es que cuando
hacemos más pruebas con una <span style="color: #32CD32;">misma variable
o variables del mismo set de datos </span> la probabilidad de que al
menos una sea espúrea aumenta.</p>
<p>Veamos cómo.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>trampa4 <span class="ot">&lt;-</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="cf">function</span>(<span class="co"># promedio de x</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">m1 =</span> <span class="dv">0</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="co"># desviacion de x</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="co"># tamaño de muestra</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="at">n1 =</span> <span class="dv">100</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="co"># numero de pruebas</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="at">ntest =</span> <span class="dv">5</span>,</span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="co"># n de simulaciones</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>    N,</span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="co"># alpha</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="co"># crear un vector para la siginficancia de la prueba</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>    V.P  <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    </span>
<span id="cb10-17"><a href="#cb10-17"></a>    <span class="co"># simulemos</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb10-19"><a href="#cb10-19"></a>      <span class="co"># variable de respuesta</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb10-21"><a href="#cb10-21"></a>      </span>
<span id="cb10-22"><a href="#cb10-22"></a>      <span class="co"># vector para los valores de p</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>      V.p <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>      </span>
<span id="cb10-25"><a href="#cb10-25"></a>      <span class="co"># un analisis con cada predictor</span></span>
<span id="cb10-26"><a href="#cb10-26"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ntest) {</span>
<span id="cb10-27"><a href="#cb10-27"></a>        M <span class="ot">&lt;-</span>  <span class="fu">lm</span> (y <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1))</span>
<span id="cb10-28"><a href="#cb10-28"></a>        S <span class="ot">&lt;-</span> <span class="fu">summary</span>(M)</span>
<span id="cb10-29"><a href="#cb10-29"></a>        V.p <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.p, <span class="at">values =</span> S<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb10-30"><a href="#cb10-30"></a>      }</span>
<span id="cb10-31"><a href="#cb10-31"></a>      </span>
<span id="cb10-32"><a href="#cb10-32"></a>      <span class="co"># registremos si hay al menos un resultado significativo</span></span>
<span id="cb10-33"><a href="#cb10-33"></a>      <span class="fu">ifelse</span>(<span class="at">test =</span> <span class="fu">any</span>(V.p <span class="sc">&lt;</span> a),</span>
<span id="cb10-34"><a href="#cb10-34"></a>             <span class="at">yes =</span> V.P[i] <span class="ot">&lt;-</span> <span class="dv">1</span>,</span>
<span id="cb10-35"><a href="#cb10-35"></a>             <span class="at">no =</span> V.P[i] <span class="ot">&lt;-</span> <span class="dv">0</span>)</span>
<span id="cb10-36"><a href="#cb10-36"></a>    }</span>
<span id="cb10-37"><a href="#cb10-37"></a>    </span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="co"># errir tipo 1 con n comparaciones</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>    err <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(V.P <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> N</span>
<span id="cb10-40"><a href="#cb10-40"></a>    </span>
<span id="cb10-41"><a href="#cb10-41"></a>    <span class="fu">cat</span>(<span class="st">&quot;Tasa de error tipo 1</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-42"><a href="#cb10-42"></a>    <span class="fu">return</span>(err)</span>
<span id="cb10-43"><a href="#cb10-43"></a>  }</span>
<span id="cb10-44"><a href="#cb10-44"></a>      </span>
<span id="cb10-45"><a href="#cb10-45"></a><span class="fu">trampa4</span>(<span class="at">ntest =</span> <span class="dv">20</span>, <span class="at">N =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Tasa de error tipo 1</code></pre>
<pre><code>## [1] 0.627</code></pre>
<div id="ejercicio-6" class="section level3 ejercicios">
<h3>Ejercicio 6</h3>
<ol style="list-style-type: decimal">
<li>¿Qué pasa si aumenta el número de tests realizados? ¿Por qué?</li>
<li>¿Qué pasa si reduce el valor de alpha? ¿Por qué?</li>
</ol>
</div>
<p> </p>
<div id="dos-preguntas-sobresalientes" class="section level3">
<h3>Dos preguntas sobresalientes</h3>
<p>Rara vez colectamos un set de datos completo para hacer un único
modelo estadístico. Si esta es su realidad ud. tiene al menos dos
preguntas.</p>
<div id="cómo-puedo-corregir-este-error" class="section level4">
<h4>¿Cómo puedo corregir este error?</h4>
<p>Existen en realidad varias maneras de lidear con este error y hace
unos años la discusión de cómo hacerlo era intensa. Primero, si el
estudio es del tipo de “prueba de hipótesis” podría limitarse mucho el
error haciendo un número razonable (pequeño) de análisis que respondan
la pregunta sin probar todo contra todo.</p>
<p>Si el análisis es más exploratorio o por alguna razón se requiren
muchas pruebas (e.g. análsis de expresión genética diferencial en los
que hay tantas pruebas como genes). necesitamos algún método para
corregir por esta inflación del error.</p>
<p>La literatura es extensa y aquí no vamos a entrar en detalles. Sólo
quiero hablar de lo básico. Uno de los primeros métodos es la <a
href="https://link.springer.com/referenceworkentry/10.1007%2F978-1-4419-9863-7_1213">corrección
de Boferroni</a>. Esta corrección consiste en simplemente dividir alpha
entre el número de pruebas y es <span
style="color: #32CD32;">abrumadoramente conservadora</span>. Con esto me
refiero a que hace que el <a
href="https://academic.oup.com/beheco/article/15/6/1044/206216">error
tipo II se dispare</a>.</p>
<p>Otro problema es que la corrección de Bonferroni <a
href="https://www.jstor.org/stable/3548200?seq=1#metadata_info_tab_contents">no
reconoce el número de comparaciones significativas</a>. Bonferroni no
distingue entre la probabilidad de que al menos una de n comparaciones
sea espúrea vs. la probabilidad de que dos o tres o cuatro de las n
comparaciones sean simultáneamente espúreas. Los últimos tres escenarios
son cada uno menos probable que el anterior.</p>
<p>Dados estos problemas (entre otros) y la existencia de métodos más
apropiados, como por ejemplo la <a
href="https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/j.2517-6161.1995.tb02031.x">tasa
de descubrimientos falsos de Benjamini-Hochberg</a> y la alternativa de
<a
href="https://academic.oup.com/beheco/article/17/4/682/215700">enfocarnos
en tamaños de efecto en lugar de valores de P</a>, es más que suficiente
para enterrar a Bonferroni.</p>
</div>
<div id="qué-es-un-mismo-set-de-datos" class="section level4">
<h4>¿Qué es “un mismo set de datos”?</h4>
<p>Si nos preocupa inflar el error tipo I al hacer muchas comparaciones
con el mismo set de datos. No es trivial preguntarse ¿qué es un mismo
set de data? ¿serán todos los datos usados en un mismo artículo? ¿todos
los datos colectados en un mismo proyecto (que produce n artículos)?
¿Todos los datos colectados en una misma población de estudio o en un
mismo laboratorio?</p>
</div>
</div>
</div>
<div id="trampa-5-reporte-selectivo" class="section level2">
<h2>Trampa 5: Reporte selectivo</h2>
<p>Esta trampa consiste en correr una serie de análisis, pero mencionar
sólo los análisis que dieron resultados significativos, como si los
demás análisis nunca se nos hubieran ocurrido. En una forma extrema,
esta trampa implica modificar y repetir algún análisis <span
style="color: #32CD32;">hasta que sea significativo
</span>(p-hacking).</p>
<p align="center">
<img src="images/phacking.png" style="width:50.0%" />
</p>
<p>Ahora, todxs sabemos que esto es un <span
style="color: #32CD32;"><strong>no no</strong></span>, pero ¿por qué?
¿Cuál es el problema realmente de reportar sólo los análisis que dieron
significativos?</p>
<p>Veamos cómo esta trampa se relaciona con la anterior.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>trampa5 <span class="ot">&lt;-</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="cf">function</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="co"># promedio de x</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">m1 =</span> <span class="dv">0</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="co"># desviacion de x</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="at">sd1 =</span> <span class="dv">1</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="co"># tamaño de muestra</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="at">n1 =</span> <span class="dv">100</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="co"># n de simulaciones</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    N,</span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="co"># alpha</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="at">a =</span> <span class="fl">0.05</span>) {</span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="co"># Crear vectores para los valores de P, R y beta</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>    V.E  <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>    </span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="co"># simulemos</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb13-18"><a href="#cb13-18"></a>      <span class="co"># variable de respuesta</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1)</span>
<span id="cb13-20"><a href="#cb13-20"></a>      <span class="co">#vector con para guardar valores de P</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>      V.P <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>      j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-23"><a href="#cb13-23"></a>      </span>
<span id="cb13-24"><a href="#cb13-24"></a>      <span class="co"># hagamos pruebas con predictores independientes, hasta que alguno de significativo</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>      <span class="cf">repeat</span> {</span>
<span id="cb13-26"><a href="#cb13-26"></a>        M <span class="ot">&lt;-</span>  <span class="fu">lm</span> (y <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n1, <span class="at">mean =</span> m1, <span class="at">sd =</span> sd1))</span>
<span id="cb13-27"><a href="#cb13-27"></a>        S <span class="ot">&lt;-</span> <span class="fu">summary</span>(M)</span>
<span id="cb13-28"><a href="#cb13-28"></a>        V.P <span class="ot">&lt;-</span> <span class="fu">append</span>(<span class="at">x =</span> V.P, <span class="at">values =</span> S<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb13-29"><a href="#cb13-29"></a>        <span class="cf">if</span> (V.P[j] <span class="sc">&gt;=</span> a){</span>
<span id="cb13-30"><a href="#cb13-30"></a>                j <span class="ot">&lt;-</span> j <span class="sc">+</span><span class="dv">1</span>} <span class="cf">else</span> {<span class="cf">break</span>}</span>
<span id="cb13-31"><a href="#cb13-31"></a>      }</span>
<span id="cb13-32"><a href="#cb13-32"></a>    len.P <span class="ot">&lt;-</span> <span class="fu">length</span>(V.P)  </span>
<span id="cb13-33"><a href="#cb13-33"></a>     V.E <span class="ot">&lt;-</span> <span class="fu">append</span> (<span class="at">x =</span> V.E, <span class="at">values =</span> len.P)  </span>
<span id="cb13-34"><a href="#cb13-34"></a>    }</span>
<span id="cb13-35"><a href="#cb13-35"></a>  </span>
<span id="cb13-36"><a href="#cb13-36"></a>  <span class="co"># grafiquemos el histograma</span></span>
<span id="cb13-37"><a href="#cb13-37"></a>   <span class="fu">hist</span>(V.E,</span>
<span id="cb13-38"><a href="#cb13-38"></a>              <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb13-39"><a href="#cb13-39"></a>              <span class="at">xlab =</span> <span class="st">&quot;Número de pruebas para llegar a p &lt; 0.05&quot;</span>,</span>
<span id="cb13-40"><a href="#cb13-40"></a>              <span class="at">ylab =</span> <span class="st">&quot;Frequencia&quot;</span>)</span>
<span id="cb13-41"><a href="#cb13-41"></a>}</span>
<span id="cb13-42"><a href="#cb13-42"></a>      </span>
<span id="cb13-43"><a href="#cb13-43"></a><span class="fu">trampa5</span>(<span class="at">N =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p><img src="trampas_estadisticas_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Al hacer p-hacking estamos inflando el error tipo 1 porque <span
style="color: #32CD32;">hay más pruebas sobre la(s) misma(s) variable(s)
de respuesta que las que estamos reportando.</span></p>
<div id="ejercicio-7" class="section level3 ejercicios">
<h3>Ejercicio 7</h3>
<ol style="list-style-type: decimal">
<li>¿Qué otras maneras de hacer p-hacking existen?</li>
<li>¿Cómo podemos hacer para evitarlas?</li>
</ol>
</div>
<p> </p>
</div>
<div id="trampa-6-especificación-del-modelo" class="section level2">
<h2>Trampa 6: Especificación del modelo</h2>
<p align="center">
<img src="./images/modelesp.png" style="width:50.0%" />
</p>
<p>Comic: Randall Munroe, <a href="https://xkcd.com/">xkcd.com</a> / CC
BY-NC (<a href="https://creativecommons.org/licenses/by-nc/2.5/"
class="uri">https://creativecommons.org/licenses/by-nc/2.5/</a>)</p>
<p>Aún si tomamos todas las precauciones para evitar las trampas
anteriores, nuestras inferencias pueden ser salvajemente incorrectas si
nuestro modelo es una representación muy pobre de la realidad. Con esto
hay que decir que todos los modelos son representaciones incompletas de
la realidad. Esa es la idea. Un modelo es útil si podemos simplificar la
realidad y aún así descubrir algo verdadero sobre la la naturaleza. Para
citar a Goerge E. P. Box <span style="color: #32CD32;">“todos los
modelos son esencialmente incorrectos, pero algunos son
útiles.”</span></p>
<p>La pregunta más difícil es por supuesto, qué tan incorrecto tiene que
ser un modelo para dejar de ser útil. Una pregunta más a nuestro alcance
por ahora es por qué es importante evitar un modelo muy incorrecto,
cuando hay otro modelo menos incorrecto disponible. Por supuesto, las
maneras en que un modelo puede ser incorrecto son infinitas. Entonces
aquí vamos a ver sólo un ejemplo.</p>
<p>Nos vamos a enfocar en situaciones en las que érroneamente asumimos
una distribución normal en los errores. Recordemos que errores son
simplemente las desviaciones entre valores observados y un estimado
(como un promedio o una línea de ajuste). Digamos que colectamos datos
sobre el número de parásitos en una población de peces. En la vida real
es común que muchos peces tengan cero o pocos parásitos, ya que han
evolucionado adpataciones para resistirlos, mientras que algunos pocos
individuos (tal vez los que ya estaban en una mala condición) tienen
muchos parásitos.</p>
<p>Aquí queremos investigar si el número de parásitos aumenta con la
temperatura del agua. Asumamos que la mayoría de los lagos tienen una
temperatura intermedia, algunos son relativamente fríos y todavía menos
son muy fríos. Igual con las temperaturas calientes, cuánto más caliente
menos común. Veamos.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">require</span>(gridExtra)</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">require</span>(DAAG)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>trampa6 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="co"># intercepto</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="at">a =</span> <span class="dv">0</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="co"># coeficiente lineal</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="at">b =</span> <span class="dv">2</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="co"># tamanio de muestra</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="co"># valor en x para la prediccion</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="at">P =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="co"># numero de simulaciones</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="at">N =</span> <span class="dv">1000</span>) {</span>
<span id="cb14-15"><a href="#cb14-15"></a>  </span>
<span id="cb14-16"><a href="#cb14-16"></a>  <span class="co"># vectores para deviance</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>  V.D1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  V.D2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  </span>
<span id="cb14-20"><a href="#cb14-20"></a>  <span class="co"># vectores para valores predichos</span></span>
<span id="cb14-21"><a href="#cb14-21"></a>  V.P1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>  V.P2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>  </span>
<span id="cb14-24"><a href="#cb14-24"></a>  <span class="co"># simulemos</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb14-26"><a href="#cb14-26"></a>    <span class="co"># x puede tomar cualquier valor entre 0 y 1</span></span>
<span id="cb14-27"><a href="#cb14-27"></a>    x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb14-28"><a href="#cb14-28"></a>    <span class="co"># usamos una funcion del paquete DAAG para simular la respuesta de acuerdo con Poisson </span></span>
<span id="cb14-29"><a href="#cb14-29"></a>    dat <span class="ot">&lt;-</span> <span class="fu">poissonsim</span>(<span class="at">x =</span> x, <span class="at">a =</span> a, <span class="at">b =</span> b)</span>
<span id="cb14-30"><a href="#cb14-30"></a>    </span>
<span id="cb14-31"><a href="#cb14-31"></a>    <span class="co"># ahora analizamos los resultados como si los errores fueran normales</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>    M<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="at">data =</span> dat)</span>
<span id="cb14-33"><a href="#cb14-33"></a>    S<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">summary.glm</span>(M<span class="fl">.1</span>)</span>
<span id="cb14-34"><a href="#cb14-34"></a>    </span>
<span id="cb14-35"><a href="#cb14-35"></a>    <span class="co"># deviance del modelo con el predictor</span></span>
<span id="cb14-36"><a href="#cb14-36"></a>    V.D1 <span class="ot">&lt;-</span> <span class="fu">append</span> (<span class="at">x =</span> V.D1, <span class="at">values =</span> S<span class="fl">.1</span><span class="sc">$</span>deviance)</span>
<span id="cb14-37"><a href="#cb14-37"></a>    </span>
<span id="cb14-38"><a href="#cb14-38"></a>    <span class="co"># numero de parasitos esperados cuando x = P</span></span>
<span id="cb14-39"><a href="#cb14-39"></a>    P1 <span class="ot">&lt;-</span></span>
<span id="cb14-40"><a href="#cb14-40"></a>      <span class="fu">predict.glm</span>(<span class="at">object =</span> M<span class="fl">.1</span>,</span>
<span id="cb14-41"><a href="#cb14-41"></a>                  <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> P),</span>
<span id="cb14-42"><a href="#cb14-42"></a>                  <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb14-43"><a href="#cb14-43"></a>    V.P1 <span class="ot">&lt;-</span> <span class="fu">append</span> (<span class="at">x =</span> V.P1, <span class="at">values =</span> P1)</span>
<span id="cb14-44"><a href="#cb14-44"></a>    </span>
<span id="cb14-45"><a href="#cb14-45"></a>    <span class="co"># ahora analizamos con la estructura de error que corresponde</span></span>
<span id="cb14-46"><a href="#cb14-46"></a>    M<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">data =</span> dat)</span>
<span id="cb14-47"><a href="#cb14-47"></a>    S<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">summary</span>(M<span class="fl">.2</span>)</span>
<span id="cb14-48"><a href="#cb14-48"></a>    </span>
<span id="cb14-49"><a href="#cb14-49"></a>    <span class="co"># deviance del modelo con el predictor</span></span>
<span id="cb14-50"><a href="#cb14-50"></a>    V.D2 <span class="ot">&lt;-</span> <span class="fu">append</span> (<span class="at">x =</span> V.D2, <span class="at">values =</span> S<span class="fl">.2</span><span class="sc">$</span>deviance)</span>
<span id="cb14-51"><a href="#cb14-51"></a>    </span>
<span id="cb14-52"><a href="#cb14-52"></a>    <span class="co"># numero de parasitos esperados cuando x = P</span></span>
<span id="cb14-53"><a href="#cb14-53"></a>    P2 <span class="ot">&lt;-</span></span>
<span id="cb14-54"><a href="#cb14-54"></a>      <span class="fu">predict.glm</span>(<span class="at">object =</span> M<span class="fl">.2</span>,</span>
<span id="cb14-55"><a href="#cb14-55"></a>                  <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> P),</span>
<span id="cb14-56"><a href="#cb14-56"></a>                  <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb14-57"><a href="#cb14-57"></a>    V.P2 <span class="ot">&lt;-</span> <span class="fu">append</span> (<span class="at">x =</span> V.P2, <span class="at">values =</span> P2)</span>
<span id="cb14-58"><a href="#cb14-58"></a>  }</span>
<span id="cb14-59"><a href="#cb14-59"></a>  </span>
<span id="cb14-60"><a href="#cb14-60"></a>  <span class="co"># juntamos todo</span></span>
<span id="cb14-61"><a href="#cb14-61"></a>  err.df <span class="ot">&lt;-</span></span>
<span id="cb14-62"><a href="#cb14-62"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb14-63"><a href="#cb14-63"></a>      <span class="at">modelo =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;poisson&quot;</span>), <span class="at">each =</span> N),</span>
<span id="cb14-64"><a href="#cb14-64"></a>      <span class="at">Deviance =</span> <span class="fu">c</span>(V.D1, V.D2),</span>
<span id="cb14-65"><a href="#cb14-65"></a>      <span class="at">Prediction =</span> <span class="fu">c</span>(V.P1, V.P2)</span>
<span id="cb14-66"><a href="#cb14-66"></a>    )</span>
<span id="cb14-67"><a href="#cb14-67"></a> </span>
<span id="cb14-68"><a href="#cb14-68"></a>  <span class="co">#graficamos los datos en la escala original</span></span>
<span id="cb14-69"><a href="#cb14-69"></a>  p1 <span class="ot">&lt;-</span></span>
<span id="cb14-70"><a href="#cb14-70"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb14-71"><a href="#cb14-71"></a>                                                       <span class="at">color =</span>  <span class="st">&quot;#32CD32&quot;</span>,</span>
<span id="cb14-72"><a href="#cb14-72"></a>                                                       <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb14-73"><a href="#cb14-73"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span>
<span id="cb14-74"><a href="#cb14-74"></a>  </span>
<span id="cb14-75"><a href="#cb14-75"></a>  <span class="co"># graficamos los histogramas de cada modelo para &quot;deviance&quot; y los valores predichos</span></span>
<span id="cb14-76"><a href="#cb14-76"></a>  p2 <span class="ot">&lt;-</span></span>
<span id="cb14-77"><a href="#cb14-77"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> err.df, <span class="fu">aes</span>(<span class="at">x =</span> Deviance, <span class="at">colour =</span> modelo, <span class="at">fill =</span> modelo)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(</span>
<span id="cb14-78"><a href="#cb14-78"></a>      <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb14-79"><a href="#cb14-79"></a>      <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb14-80"><a href="#cb14-80"></a>      <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-81"><a href="#cb14-81"></a>      <span class="at">lwd =</span> <span class="fl">0.2</span></span>
<span id="cb14-82"><a href="#cb14-82"></a>    ) <span class="sc">+</span></span>
<span id="cb14-83"><a href="#cb14-83"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb14-84"><a href="#cb14-84"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-85"><a href="#cb14-85"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-86"><a href="#cb14-86"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb14-87"><a href="#cb14-87"></a>      <span class="at">xintercept =</span> n <span class="sc">-</span> <span class="dv">2</span>,</span>
<span id="cb14-88"><a href="#cb14-88"></a>      <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb14-89"><a href="#cb14-89"></a>      <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb14-90"><a href="#cb14-90"></a>      <span class="at">colour =</span> <span class="st">&quot;grey20&quot;</span></span>
<span id="cb14-91"><a href="#cb14-91"></a>    )</span>
<span id="cb14-92"><a href="#cb14-92"></a>  </span>
<span id="cb14-93"><a href="#cb14-93"></a>  p3 <span class="ot">&lt;-</span></span>
<span id="cb14-94"><a href="#cb14-94"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> err.df, <span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">colour =</span> modelo, <span class="at">fill =</span> modelo)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(</span>
<span id="cb14-95"><a href="#cb14-95"></a>      <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb14-96"><a href="#cb14-96"></a>      <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb14-97"><a href="#cb14-97"></a>      <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-98"><a href="#cb14-98"></a>      <span class="at">lwd =</span> <span class="fl">0.2</span></span>
<span id="cb14-99"><a href="#cb14-99"></a>    ) <span class="sc">+</span></span>
<span id="cb14-100"><a href="#cb14-100"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb14-101"><a href="#cb14-101"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-102"><a href="#cb14-102"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#BDB76B&quot;</span>, <span class="st">&quot;#32CD32&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-103"><a href="#cb14-103"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Predicción para x = P&quot;</span>)</span>
<span id="cb14-104"><a href="#cb14-104"></a>  </span>
<span id="cb14-105"><a href="#cb14-105"></a>  <span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb14-106"><a href="#cb14-106"></a>}</span>
<span id="cb14-107"><a href="#cb14-107"></a></span>
<span id="cb14-108"><a href="#cb14-108"></a><span class="fu">trampa6</span>(<span class="at">N =</span> <span class="dv">1000</span>, <span class="at">b =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="trampas_estadisticas_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div id="ejercicio-8" class="section level3 ejercicios">
<h3>Ejercicio 8</h3>
<ol style="list-style-type: decimal">
<li>¿Qué pasa al aumentar b? ¿Por qúe?</li>
<li>¿Qué pasa cuando b = 0? ¿Por qué?</li>
</ol>
</div>
<p> </p>
<div id="moraleja-1" class="section level4">
<h4>Moraleja</h4>
<p>Tres preguntas de que preocuparse son:</p>
<ol style="list-style-type: decimal">
<li><p>¿Cuáles son los supuestos que hace mi análisis?</p></li>
<li><p>¿Qué razones tengo para creer que mis datos no violan esos
supuestos?</p></li>
<li><p>¿Qué tan robusto es el modelo a la violación de distintos
supuestos?</p></li>
</ol>
<div class="sourceCode" id="cb15"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.2 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/atlas/libblas.so.3.10.3
## LAPACK: /usr/lib/x86_64-linux-gnu/atlas/liblapack.so.3.10.3
## 
## locale:
##  [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=es_CR.UTF-8        LC_COLLATE=pt_BR.UTF-8    
##  [5] LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
##  [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] DAAG_1.25.4         gridExtra_2.3       lme4_1.1-27.1      
## [4] Matrix_1.3-4        ggplot2_3.3.6       kableExtra_1.3.1   
## [7] knitr_1.39          xaringanExtra_0.7.0 emo_0.0.0.9000     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.9          lubridate_1.7.10    lattice_0.20-44    
##  [4] png_0.1-7           assertthat_0.2.1    digest_0.6.29      
##  [7] utf8_1.2.2          R6_2.5.1            evaluate_0.15      
## [10] httr_1.4.2          highr_0.9           pillar_1.8.0       
## [13] Rdpack_2.4          rlang_1.0.5         uuid_0.1-4         
## [16] rstudioapi_0.13     minqa_1.2.4         jquerylib_0.1.4    
## [19] nloptr_1.2.2.2      rmarkdown_2.16      labeling_0.4.2     
## [22] splines_4.1.0       webshot_0.5.2       stringr_1.4.0      
## [25] munsell_0.5.0       compiler_4.1.0      xfun_0.31          
## [28] pkgconfig_2.0.3     htmltools_0.5.3     tidyselect_1.1.1   
## [31] tibble_3.1.8        fansi_1.0.3         viridisLite_0.4.0  
## [34] crayon_1.5.1        dplyr_1.0.7         withr_2.5.0        
## [37] rbibutils_2.2.9     MASS_7.3-54         grid_4.1.0         
## [40] nlme_3.1-152        jsonlite_1.8.0      gtable_0.3.0       
## [43] lifecycle_1.0.1     DBI_1.1.1           magrittr_2.0.3     
## [46] formatR_1.11        scales_1.2.0        cli_3.3.0          
## [49] stringi_1.7.8       farver_2.1.1        latticeExtra_0.6-29
## [52] xml2_1.3.2          bslib_0.2.5.1       generics_0.1.0     
## [55] vctrs_0.4.1         boot_1.3-28         RColorBrewer_1.1-3 
## [58] tools_4.1.0         glue_1.6.2          purrr_0.3.4        
## [61] jpeg_0.1-8.1        fastmap_1.1.0       yaml_2.3.5         
## [64] colorspace_2.0-3    rvest_1.0.0         sass_0.4.0</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
